<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>OnlineBadganMall - Place Order</title>
<link rel="stylesheet" href="style.css">
<style>
table { width: 100%; border-collapse: collapse; margin-bottom: 10px; }
th, td { border: 1px solid #ddd; padding: 8px; text-align: left; }
img { width: 60px; height: auto; border-radius: 5px; }
button:disabled { background-color: #ccc; cursor: not-allowed; }
.order-summary p { margin: 5px 0; font-weight: bold; }
.phone-container {
  display: flex;
  align-items: center;
  border: 1px solid #ccc;
  padding: 5px;
  border-radius: 8px;
  width: 250px;
  margin-bottom: 10px;
}
.phone-container span {
  margin-right: 5px;
  font-size: 18px;
}
.phone-container input {
  border: none;
  outline: none;
  flex: 1;
  font-size: 16px;
  padding: 5px;
}
</style>
</head>
<body>

<header>
    <h1>Place Your Order</h1>
    <p>Home Delivery Available in Timmapur!</p>
</header>

<nav>
    <a href="index.html">Products</a>
    <a href="order.html">Place Order</a>
    <a href="contact.html">Contact Us</a>
</nav>

<div class="order-form" id="order">
    <h2>Your Cart</h2>
    <table id="cart-table">
        <thead>
            <tr>
                <th>Photo</th>
                <th>Product</th>
                <th>Price</th>
                <th>Remove</th>
            </tr>
        </thead>
        <tbody id="cart-items"></tbody>
    </table>

    <div class="order-summary">
        <p id="total-amount">Total Amount: â‚¹0</p>
        <p id="delivery-charge">Delivery Charge: â‚¹10</p>
        <p id="grand-total">Grand Total: â‚¹0</p>
        <p id="min-order-warning" style="color:red; display:none; font-weight:bold;">
            Minimum order â‚¹500 required
        </p>
    </div>

    <form id="orderForm" action="https://formspree.io/f/mzzjeyby" method="POST">
        <label for="name">Name:</label>
        <input type="text" id="name" name="name" placeholder="Your Name" required>

        <label for="mobile">Mobile:</label>
        <div class="phone-container">
            <span>ðŸ‡®ðŸ‡³ +91</span>
            <input type="tel" id="mobile" name="mobile" placeholder="Enter 10-digit number" required>
        </div>

        <label>Address:</label>
        <textarea id="address" name="address" placeholder="Delivery Address in Timmapur" required></textarea>

        <label>Order Details:</label>
        <textarea name="order_details" readonly id="order_details"></textarea>

        <button type="submit" id="submitOrderBtn" disabled>Submit Order</button>
    </form>
</div>

<footer>
    <p>Contact: 9999999999 | Visit us in Timmapur</p>
    <p>CEO: Mr. Mohammed Shafee</p>
</footer>

<script src="script.js"></script>
<script>
// ------------------ Cart Initialization ------------------
let cart = JSON.parse(localStorage.getItem('cart') || '[]');
// Ensure qty exists and numeric
cart = cart.map(item => ({...item, qty: item.qty ? Number(item.qty) : 1}));

const mobileInput = document.getElementById("mobile");
const nameInput = document.getElementById("name");
const addressInput = document.getElementById("address");
const submitBtn = document.getElementById("submitOrderBtn");
const minOrderWarning = document.getElementById("min-order-warning");
const deliveryCharge = 10;

// ------------------ Mobile Validation ------------------
mobileInput.addEventListener("input", () => {
    let digits = mobileInput.value.replace(/\D/g, "").substring(0, 10);
    mobileInput.value = digits;
});

// ------------------ Total Calculation ------------------
function getTotalAmount() {
    return cart.reduce((sum, i) => sum + (Number(i.price) * Number(i.qty)), 0);
}

// ------------------ Update Submit Button ------------------
function updateSubmitButton() {
    const totalAmount = getTotalAmount();
    const name = nameInput.value.trim();
    const address = addressInput.value.trim();

    minOrderWarning.style.display = (totalAmount < 500) ? 'block' : 'none';
    submitBtn.disabled = !(totalAmount >= 500 && name !== "" && address !== "");
}

// ------------------ Render Cart ------------------
function renderCart() {
    const cartItems = document.getElementById('cart-items');
    if(!cartItems) return;
    cartItems.innerHTML = '';
    let totalAmount = 0;

    cart.forEach((item,index)=>{
        totalAmount += Number(item.price)*Number(item.qty);
        cartItems.innerHTML += `<tr>
            <td><img src="${item.photo}" alt="${item.name}"></td>
            <td>${item.name} x ${item.qty}</td>
            <td>â‚¹${Number(item.price)*Number(item.qty)}</td>
            <td><button class="remove" onclick="removeItem(${index})">Remove</button></td>
        </tr>`;
    });

    document.getElementById('total-amount').innerText = `Total Amount: â‚¹${totalAmount}`;
    document.getElementById('grand-total').innerText = `Grand Total: â‚¹${totalAmount + deliveryCharge}`;

    const orderDetails = document.getElementById('order_details');
    if(orderDetails){
        orderDetails.value = cart.length > 0 ?
            cart.map(i=>`${i.name} x ${i.qty} - â‚¹${i.price*i.qty}`).join("\n")+
            `\nTotal Amount: â‚¹${totalAmount}\nDelivery Charge: â‚¹${deliveryCharge}\nGrand Total: â‚¹${totalAmount + deliveryCharge}` :
            "Your cart is empty.";
    }

    updateSubmitButton();
}

// ------------------ Remove Item ------------------
function removeItem(index){
    cart.splice(index,1);
    localStorage.setItem('cart', JSON.stringify(cart));
    renderCart();
}

// ------------------ Input Listeners ------------------
[nameInput,addressInput].forEach(input => input.addEventListener("input", updateSubmitButton));

// ------------------ Form Submit ------------------
document.getElementById('orderForm')?.addEventListener('submit', function(e){
    const totalAmount = getTotalAmount();
    if(cart.length === 0 || totalAmount < 500){
        e.preventDefault();
        alert("Cart is empty or total amount less than â‚¹500!");
        return;
    }
    const digits = mobileInput.value.replace(/\D/g,'');
    if(digits.length !== 10){
        e.preventDefault();
        alert("Please enter a valid 10-digit mobile number");
        return;
    }
    setTimeout(()=>{
        cart = [];
        localStorage.setItem('cart', JSON.stringify(cart));
        renderCart();
        alert("Order submitted! You will receive confirmation email.");
    },100);
});

// ------------------ Initialize ------------------
document.addEventListener("DOMContentLoaded", function(){
    renderCart();
    updateSubmitButton(); // ensures correct button state on reload
});
</script>
</body>
</html>
